if(!Joomla)throw new Error("Joomla API is not properly initialised");((e,t,i)=>{const l={view:"dashboard",id:0,ordering:"",version:"current",list:0,options:i.getOptions("plg_installer_webinstaller",{})};let s;class n{initialise(){l.loaded=1;t.getElementById("uploadform-web-cancel").addEventListener("click",(()=>{t.getElementById("uploadform-web").classList.add("hidden"),l.list&&t.querySelector(".list-view")&&t.querySelector(".list-view").click()}));t.getElementById("uploadform-web-install").addEventListener("click",(()=>{4===l.options.installFrom?this.submitButtonUrl():this.submitButtonWeb()})),this.loadweb(`${l.options.base_url}index.php?format=json&option=com_apps&view=dashboard`),this.clickforlinks()}loadweb(s){if(!s)return!1;const r=new RegExp(l.options.base_url),a=new RegExp("^index.php");if(!r.test(s)&&!a.test(s))return e.open(s,"_blank"),!1;let o=`${s}&product=${l.options.product}&release=${l.options.release}&dev_level=${l.options.dev_level}&list=${l.list?"list":"grid"}&lang=${l.options.language}`;const d=t.getElementById("com-apps-ordering"),c=t.getElementById("com-apps-filter-joomla-version");return""!==l.ordering&&d&&d.value&&(l.ordering=d.value,o+=`&ordering=${l.ordering}`),""!==l.version&&c&&c.value&&(l.version=c.value,o+=`&filter_version=${l.version}`),n.showLoadingLayer(),new Promise(((e,s)=>{i.request({url:o,onSuccess:s=>{let r;try{r=JSON.parse(s)}catch(e){throw new Error("Failed to parse JSON")}t.getElementById("web-loader")&&t.getElementById("web-loader").classList.add("hidden");t.getElementById("jed-container").innerHTML=r.data.html,t.getElementById("com-apps-searchbox").addEventListener("keypress",(({which:e})=>{13===e&&this.initiateSearch()})),t.getElementById("search-extensions").addEventListener("click",(()=>{this.initiateSearch()})),t.getElementById("search-reset").addEventListener("click",(()=>{t.getElementById("com-apps-searchbox").value="",this.initiateSearch(),t.getElementById("search-reset").setAttribute("disabled","disabled")})),""===t.getElementById("com-apps-searchbox").value&&t.getElementById("search-reset").setAttribute("disabled","disabled"),t.getElementById("search-reset").innerHTML=i.JText._("JSEARCH_FILTER_CLEAR");const a=t.getElementById("com-apps-ordering"),o=t.getElementById("com-apps-filter-joomla-version");a&&a.addEventListener("change",(()=>{const e=a.selectedIndex;l.ordering=a.options[e].value,this.installfromwebajaxsubmit()})),o&&o.addEventListener("change",(()=>{const e=o.selectedIndex;l.version=o.options[e].value,this.installfromwebajaxsubmit()})),""!==l.options.installfrom_url&&n.installfromweb(l.options.installfrom_url),e()},onError:e=>{const l=t.getElementById("web-loader-error"),n=t.getElementById("web-loader");e.responseText&&l&&(l.innerHTML=e.responseText),n&&(n.classList.add("hidden"),l.classList.remove("hidden")),i.renderMessages({danger:[i.Text._("PLG_INSTALLER_WEBINSTALLER_INSTALL_WEB_LOADING_ERROR")]},"#web-loader-error"),s()}})})).finally((()=>{const s=t.getElementById("joomlaapsinstallatinput");if(s&&(s.value=l.options.installat_url),this.clickforlinks(),n.clicker(),"extension"!==l.view&&[].slice.call(t.querySelectorAll("div.load-extension")).forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),this.processLinkClick(e.getAttribute("data-url"))})),e.setAttribute("href","#")})),"extension"===l.view){const l=t.getElementById("install-extension"),s=t.getElementById("install-extension-from-external");l&&l.addEventListener("click",(()=>{n.installfromweb(l.getAttribute("data-downloadurl"),l.getAttribute("data-name")),t.getElementById("uploadform-web-install").scrollIntoView({behavior:"smooth",block:"start"})})),s&&s.addEventListener("click",(()=>{const l=s.getAttribute("data-downloadurl");!0===e.confirm(i.Text._("PLG_INSTALLER_WEBINSTALLER_REDIRECT_TO_EXTERNAL_SITE_TO_INSTALL").replace("[SITEURL]",l))&&(t.getElementById("adminForm").setAttribute("action",l),t.querySelector("input[name=task]").setAttribute("disabled",!0),t.querySelector("input[name=install_directory]").setAttribute("disabled",!0),t.querySelector("input[name=install_url]").setAttribute("disabled",!0),t.querySelector("input[name=installtype]").setAttribute("disabled",!0),t.querySelector("input[name=filter_search]").setAttribute("disabled",!0),t.getElementById("adminForm").submit())}))}l.list&&t.querySelector(".list-view")&&t.querySelector(".list-view").click(),n.hideLoadingLayer()})),!0}clickforlinks(){[].slice.call(t.querySelectorAll("a.transcode")).forEach((e=>{const t=e.getAttribute("href");e.addEventListener("click",(e=>{e.preventDefault(),this.processLinkClick(t)})),e.setAttribute("href","#")}))}initiateSearch(){t.getElementById("search-reset").removeAttribute("disabled"),l.view="dashboard",this.installfromwebajaxsubmit()}installfromwebajaxsubmit(){let e=`&view=${l.view}`;if(l.id&&(e+=`&id=${l.id}`),t.getElementById("com-apps-searchbox").value){e+=`&filter_search=${encodeURI(t.getElementById("com-apps-searchbox").value.toLowerCase().replace(/ +/g,"_").replace(/[^a-z0-9-_]/g,"").trim())}`}const i=t.getElementById("com-apps-ordering"),s=t.getElementById("com-apps-filter-joomla-version");""!==l.ordering&&i&&i.value&&(l.ordering=i.value),l.ordering&&(e+=`&ordering=${l.ordering}`),""!==l.version&&s&&s.value&&(l.version=s.value),l.version&&(e+=`&filter_version=${l.version}`),this.loadweb(`${l.options.base_url}index.php?format=json&option=com_apps${e}`)}processLinkClick(e){const t=new RegExp(l.options.base_url),i=new RegExp("^index.php");t.test(e)||i.test(e)?(l.view=e.replace(/^.+[&?]view=(\w+).*$/,"$1"),"dashboard"===l.view?l.id=0:"category"===l.view&&(l.id=e.replace(/^.+[&?]id=(\d+).*$/,"$1")),this.loadweb(l.options.base_url+e)):this.loadweb(e)}static showLoadingLayer(){t.getElementById("web").appendChild(t.createElement("joomla-core-loader"))}static hideLoadingLayer(){const e=t.querySelector("#web joomla-core-loader");e.parentNode.removeChild(e)}static clicker(){t.querySelector(".grid-view")&&t.querySelector(".grid-view").addEventListener("click",(()=>{l.list=0,t.querySelector(".list-container").classList.add("hidden"),t.querySelector(".grid-container").classList.remove("hidden"),t.getElementById("btn-list-view").classList.remove("active"),t.getElementById("btn-grid-view").classList.remove("active")})),t.querySelector(".list-view")&&t.querySelector(".list-view").addEventListener("click",(()=>{l.list=1,t.querySelector(".grid-container").classList.add("hidden"),t.querySelector(".list-container").classList.remove("hidden"),t.getElementById("btn-grid-view").classList.remove("active"),t.getElementById("btn-list-view").classList.add("active")}))}static installfromweb(e,l=null){return e?(t.getElementById("install_url").value=e,t.getElementById("uploadform-web-url").innerText=e,l?(t.getElementById("uploadform-web-name").innerText=l,t.getElementById("uploadform-web-name-label").classList.remove("hidden")):t.getElementById("uploadform-web-name-label").classList.add("hidden"),t.getElementById("uploadform-web").classList.remove("hidden"),!0):(i.renderMessages({warning:[i.Text._("PLG_INSTALLER_WEBINSTALLER_CANNOT_INSTALL_EXTENSION_IN_PLUGIN")]}),!1)}submitButtonUrl(){const e=t.getElementById("adminForm");if(""===e.install_url.value||"http://"===e.install_url.value||"https://"===e.install_url.value)i.renderMessages({warning:[i.Text._("COM_INSTALLER_MSG_INSTALL_ENTER_A_URL")]});else{const i=t.getElementById("loading");i&&i.classList.remove("hidden"),e.installtype.value="url",e.submit()}}submitButtonWeb(){const e=t.getElementById("adminForm");""!==e.install_url.value||"http://"!==e.install_url.value||"https://"!==e.install_url.value?this.submitButtonUrl():""===e.install_url.value?i.renderMessages({warning:[i.apps.options.btntxt]}):(t.querySelector("#appsloading").classList.remove("hidden"),e.installtype.value="web",e.submit())}}t.addEventListener("DOMContentLoaded",(()=>{const i=()=>{const r=t.getElementById("myTab");if("UL"!==r.firstElementChild.tagName)return void e.setTimeout(i,50);const a=r.querySelector("#tab-web");a&&(l.options.installfromon&&a.click(),a.hasAttribute("active")&&!s&&(s=new n,s.initialise()),""!==l.options.installfrom_url&&a.click(),a.addEventListener("joomla.tab.shown",(()=>{s||(s=new n,s.initialise())})))};e.setTimeout(i,50)}))})(window,document,Joomla);
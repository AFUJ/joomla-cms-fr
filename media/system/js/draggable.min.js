let url,direction,isNested,dragElementIndex,dropElementIndex,container=document.querySelector(".js-draggable");const orderRows=container.querySelectorAll('[name="order[]"]');if(container)url=container.dataset.url,direction=container.dataset.direction,isNested=container.dataset.nested;else if(Joomla.getOptions("draggable-list")){const e=Joomla.getOptions("draggable-list");container=document.querySelector(e.id),container.classList.contains("js-draggable")||container.classList.add("js-draggable"),({url:url}=e),({direction:direction}=e),isNested=e.nested}if(container){for(let e=0,t=orderRows.length;t>e;e+=1)orderRows[e].dataset.order=e+1;document.addEventListener("touchstart",(()=>{}),!1);const e=(e,t,r,a)=>{let o;const n=[];if(r<a){for(e[a].setAttribute("value",e[a-1].value),o=r;o<a;o+=1)"asc"===direction?e[o].setAttribute("value",parseInt(e[o].value,10)-1):e[o].setAttribute("value",parseInt(e[o].value,10)+1),n.push(`order[]=${encodeURIComponent(e[o].value)}`),n.push(`cid[]=${encodeURIComponent(t[o].value)}`);n.push(`order[]=${encodeURIComponent(e[a].value)}`),n.push(`cid[]=${encodeURIComponent(t[a].value)}`)}else for(e[a].setAttribute("value",e[a+1].value),e[a].value=e[a+1].value,n.push(`order[]=${encodeURIComponent(e[a].value)}`),n.push(`cid[]=${encodeURIComponent(t[a].value)}`),o=a+1;o<=r;o+=1)e[o].value="asc"===direction?parseInt(e[o].value,10)+1:parseInt(e[o].value,10)-1,n.push(`order[]=${encodeURIComponent(e[o].value)}`),n.push(`cid[]=${encodeURIComponent(t[o].value)}`);return n};dragula([container],{direction:"vertical",copy:!1,revertOnSpill:!0,accepts:(e,t,r,a)=>isNested&&null!==a?a.dataset.draggableGroup&&a.dataset.draggableGroup===e.dataset.draggableGroup:null===a||a&&"tr"===a.tagName.toLowerCase(),mirrorContainer:container}).on("drag",(e=>{dragElementIndex=parseInt(e.querySelector('[name="order[]"]').dataset.order,10)-1})).on("cloned",(()=>{})).on("drop",(t=>{let r,a;const o=t.dataset.draggableGroup;o?(r=`[data-draggable-group="${o}"] [name="order[]"]`,a=`[data-draggable-group="${o}"] [name="cid[]"]`):(r='[name="order[]"]',a='[name="cid[]"]');const n=[].slice.call(container.querySelectorAll(r)),d=[].slice.call(container.querySelectorAll(a));for(let e=0,r=n.length-1;r>e;e+=1)if(n[e].dataset.order===t.querySelector('[name="order[]"]').dataset.order){dropElementIndex=e;break}if(url){const t=document.querySelector('[name="task"]');t&&t.setAttribute("name","some__Temporary__Name__");const r={url:url,method:"POST",data:e(n,d,dragElementIndex,dropElementIndex).join("&"),perform:!0};Joomla.request(r),t&&t.setAttribute("name","task")}})).on("dragend",(()=>{const e=container.querySelectorAll('[name="order[]"]');for(let t=0,r=e.length;r>t;t+=1)e[t].dataset.order=t+1}))}
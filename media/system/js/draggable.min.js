let url,direction,isNested,dragElementIndex,dropElementIndex,container=document.querySelector(".js-draggable");const orderRows=container.querySelectorAll('[name="order[]"]');if(container)url=container.dataset.url,direction=container.dataset.direction,isNested=container.dataset.nested;else if(Joomla.getOptions("draggable-list")){const e=Joomla.getOptions("draggable-list");container=document.querySelector(e.id),container.classList.contains("js-draggable")||container.classList.add("js-draggable"),({url:url}=e),({direction:direction}=e),isNested=e.nested}if(container){for(let e=0,t=orderRows.length;t>e;e+=1)orderRows[e].dataset.order=e+1;document.addEventListener("touchstart",(()=>{}),!1);const e=(e,t,r,a)=>{let n;const o=[];if(r<a){for(e[a].setAttribute("value",e[a-1].value),n=r;n<a;n+=1)"asc"===direction?e[n].setAttribute("value",parseInt(e[n].value,10)-1):e[n].setAttribute("value",parseInt(e[n].value,10)+1),o.push(`order[]=${encodeURIComponent(e[n].value)}`),o.push(`cid[]=${encodeURIComponent(t[n].value)}`);o.push(`order[]=${encodeURIComponent(e[a].value)}`),o.push(`cid[]=${encodeURIComponent(t[a].value)}`)}else for(e[a].setAttribute("value",e[a+1].value),e[a].value=e[a+1].value,o.push(`order[]=${encodeURIComponent(e[a].value)}`),o.push(`cid[]=${encodeURIComponent(t[a].value)}`),n=a+1;n<=r;n+=1)e[n].value="asc"===direction?parseInt(e[n].value,10)+1:parseInt(e[n].value,10)-1,o.push(`order[]=${encodeURIComponent(e[n].value)}`),o.push(`cid[]=${encodeURIComponent(t[n].value)}`);return o};dragula([container],{direction:"vertical",copy:!1,revertOnSpill:!0,accepts:(e,t,r,a)=>isNested&&null!==a?a.dataset.draggableGroup&&a.dataset.draggableGroup===e.dataset.draggableGroup:null===a||a&&"tr"===a.tagName.toLowerCase(),mirrorContainer:container}).on("drag",(e=>{let t;const r=e.dataset.draggableGroup;t=r?`tr[data-draggable-group="${r}"]`:"tr";const a=[].slice.call(container.querySelectorAll(t));dragElementIndex=a.indexOf(e)})).on("cloned",(()=>{})).on("drop",(t=>{let r,a,n;const o=t.dataset.draggableGroup;o?(n=`tr[data-draggable-group="${o}"]`,r=`[data-draggable-group="${o}"] [name="order[]"]`,a=`[data-draggable-group="${o}"] [name="cid[]"]`):(n="tr",r='[name="order[]"]',a='[name="cid[]"]');const l=[].slice.call(container.querySelectorAll(n)),d=[].slice.call(container.querySelectorAll(r)),c=[].slice.call(container.querySelectorAll(a));if(dropElementIndex=l.indexOf(t),url){const t=document.querySelector('[name="task"]');t&&t.setAttribute("name","some__Temporary__Name__");const r={url:url,method:"POST",data:e(d,c,dragElementIndex,dropElementIndex).join("&"),perform:!0};Joomla.request(r),t&&t.setAttribute("name","task")}})).on("dragend",(()=>{const e=container.querySelectorAll('[name="order[]"]');for(let t=0,r=e.length;r>t;t+=1)e[t].dataset.order=t+1}))}
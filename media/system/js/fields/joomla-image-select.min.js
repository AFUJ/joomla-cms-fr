((e,t)=>{if(!t)throw new Error("Joomla API is not properly initiated");t.selectedMediaFile={},window.document.addEventListener("onMediaFileSelected",(e=>{t.selectedMediaFile=e.detail;const i=t.Modal.getCurrent(),s=i.querySelector(".modal-body"),l=s.querySelector("joomla-field-mediamore");l&&l.parentNode.removeChild(l),s.closest("joomla-field-media")||t.selectedMediaFile.path&&s.insertAdjacentHTML("afterbegin",`\n<joomla-field-mediamore\n  parent-id="${i.id}"\n  summary-label="${t.Text._("JFIELD_MEDIA_SUMMARY_LABEL")}"\n  lazy-label="${t.Text._("JFIELD_MEDIA_LAZY_LABEL")}"\n  alt-label="${t.Text._("JFIELD_MEDIA_ALT_LABEL")}"\n  alt-check-label="${t.Text._("JFIELD_MEDIA_ALT_CHECK_LABEL")}"\n  alt-check-desc-label="${t.Text._("JFIELD_MEDIA_ALT_CHECK_DESC_LABEL")}"\n  classes-label="${t.Text._("JFIELD_MEDIA_CLASS_LABEL")}"\n  figure-classes-label="${t.Text._("JFIELD_MEDIA_FIGURE_CLASS_LABEL")}"\n  figure-caption-label="${t.Text._("JFIELD_MEDIA_FIGURE_CAPTION_LABEL")}"\n></joomla-field-mediamore>\n`)}));const i=e=>new Promise(((i,s)=>{const l=new Image;l.src=e,l.onload=()=>{t.selectedMediaFile.width=l.width,t.selectedMediaFile.height=l.height,i(!0)},l.onerror=()=>{s(!1)}})),s=async(e,s,l)=>{if(!0===e.success){const n=e.data[0];if(n.url)if(/local-/.test(n.adapter)){const{rootFull:e}=t.getOptions("system.paths");t.selectedMediaFile.url=n.url.split(e)[1],n.thumb_path?t.selectedMediaFile.thumb=n.thumb_path:t.selectedMediaFile.thumb=!1}else n.thumb_path&&(t.selectedMediaFile.url=n.url,t.selectedMediaFile.thumb=n.thumb_path);else t.selectedMediaFile.url=!1;if(t.selectedMediaFile.url){let e,r="",c="",d="",h="",o="",u="",p="";if(a=s,"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName){if(0===t.selectedMediaFile.width||0===t.selectedMediaFile.height)try{await i(t.selectedMediaFile.url)}catch(e){t.selectedMediaFile.height=0,t.selectedMediaFile.width=0}s.value=`${t.selectedMediaFile.url}#joomlaImage://${n.path.replace(":","")}?width=${t.selectedMediaFile.width}&height=${t.selectedMediaFile.height}`,l.updatePreview()}else{if(e=l.closest(".modal-content").querySelector("joomla-field-mediamore"),e&&("true"===e.getAttribute("alt-check")&&(d=' alt=""'),c=e.getAttribute("alt-value")?` alt="${e.getAttribute("alt-value")}"`:d,h=e.getAttribute("img-classes")?` class="${e.getAttribute("img-classes")}"`:"",o=e.getAttribute("fig-classes")?` class="${e.getAttribute("fig-classes")}"`:"",u=e.getAttribute("fig-caption")?`${e.getAttribute("fig-caption")}`:"","true"===e.getAttribute("is-lazy")&&(r=` loading="lazy" width="${t.selectedMediaFile.width}" height="${t.selectedMediaFile.height}"`,0===t.selectedMediaFile.width||0===t.selectedMediaFile.height)))try{await i(t.selectedMediaFile.url),r=` loading="lazy" width="${t.selectedMediaFile.width}" height="${t.selectedMediaFile.height}"`}catch(e){r=""}p=u?`<figure${o}><img src="${t.selectedMediaFile.url}"${h}${r}${c}/><figcaption>${u}</figcaption></figure>`:`<img src="${t.selectedMediaFile.url}"${h}${r}${c}/>`,e&&e.parentNode.removeChild(e),t.editors.instances[s].replaceSelection(p)}}}var a};t.getImage=(e,i,l)=>new Promise(((a,n)=>{if(!e||"object"==typeof e&&(!e.path||""===e.path))return t.selectedMediaFile={},void a({resp:{success:!1}});const r=`${t.getOptions("system.paths").baseFull}index.php?option=com_media`;t.request({url:`${r}&task=api.files&url=true&path=${e.path}&${t.getOptions("csrf.token")}=1&format=json`,method:"GET",perform:!0,headers:{"Content-Type":"application/json"},onSuccess:async e=>{const t=JSON.parse(e);a(await s(t,i,l))},onError:e=>{n(e)}})}));class l extends HTMLElement{constructor(){super(),this.lazyInputFn=this.lazyInputFn.bind(this),this.altInputFn=this.altInputFn.bind(this),this.altCheckFn=this.altCheckFn.bind(this),this.imgClassesFn=this.imgClassesFn.bind(this),this.figclassesFn=this.figclassesFn.bind(this),this.figcaptionFn=this.figcaptionFn.bind(this)}get parentId(){return this.getAttribute("parent-id")}get lazytext(){return this.getAttribute("lazy-label")}get alttext(){return this.getAttribute("alt-label")}get altchecktext(){return this.getAttribute("alt-check-label")}get altcheckdesctext(){return this.getAttribute("alt-check-desc-label")}get classestext(){return this.getAttribute("classes-label")}get figclassestext(){return this.getAttribute("figure-classes-label")}get figcaptiontext(){return this.getAttribute("figure-caption-label")}get summarytext(){return this.getAttribute("summary-label")}connectedCallback(){this.innerHTML=`\n<details open>\n  <summary>${this.summarytext}</summary>\n  <div class="">\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="${this.parentId}-alt">${this.alttext}</label>\n        <input class="form-control" type="text" id="${this.parentId}-alt" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="form-check">\n        <input class="form-check-input" type="checkbox" id="${this.parentId}-alt-check">\n        <label class="form-check-label" for="${this.parentId}-alt-check">${this.altchecktext}</label>\n        <div><small class="form-text">${this.altcheckdesctext}</small></div>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="form-check">\n        <input class="form-check-input" type="checkbox" id="${this.parentId}-lazy" checked>\n        <label class="form-check-label" for="${this.parentId}-lazy">${this.lazytext}</label>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="${this.parentId}-classes">${this.classestext}</label>\n        <input class="form-control" type="text" id="${this.parentId}-classes" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="${this.parentId}-figclasses">${this.figclassestext}</label>\n        <input class="form-control" type="text" id="${this.parentId}-figclasses" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="${this.parentId}-figcaption">${this.figcaptiontext}</label>\n        <input class="form-control" type="text" id="${this.parentId}-figcaption" />\n      </div>\n    </div>\n  </div>\n</details>`,this.lazyInput=this.querySelector(`#${this.parentId}-lazy`),this.lazyInput.addEventListener("change",this.lazyInputFn),this.altInput=this.querySelector(`#${this.parentId}-alt`),this.altInput.addEventListener("input",this.altInputFn),this.altCheck=this.querySelector(`#${this.parentId}-alt-check`),this.altCheck.addEventListener("input",this.altCheckFn),this.imgClasses=this.querySelector(`#${this.parentId}-classes`),this.imgClasses.addEventListener("input",this.imgClassesFn),this.figClasses=this.querySelector(`#${this.parentId}-figclasses`),this.figClasses.addEventListener("input",this.figclassesFn),this.figCaption=this.querySelector(`#${this.parentId}-figcaption`),this.figCaption.addEventListener("input",this.figcaptionFn),this.setAttribute("is-lazy",!!this.lazyInput.checked),this.setAttribute("alt-value",""),this.setAttribute("alt-check",!1),this.setAttribute("img-classes",""),this.setAttribute("fig-classes",""),this.setAttribute("fig-caption","")}disconnectedCallback(){this.lazyInput.removeEventListener("input",this.lazyInputFn),this.altInput.removeEventListener("input",this.altInputFn),this.altCheck.removeEventListener("input",this.altCheckFn),this.imgClasses.removeEventListener("input",this.imgClassesFn),this.figClasses.removeEventListener("input",this.figclassesFn),this.figCaption.removeEventListener("input",this.figcaptionFn),this.innerHTML=""}lazyInputFn(e){this.setAttribute("is-lazy",!!e.target.checked)}altInputFn(e){this.setAttribute("alt-value",e.target.value.replace(/"/g,"&quot;"))}altCheckFn(e){this.setAttribute("alt-check",!!e.target.checked)}imgClassesFn(e){this.setAttribute("img-classes",e.target.value)}figclassesFn(e){this.setAttribute("fig-classes",e.target.value)}figcaptionFn(e){this.setAttribute("fig-caption",e.target.value)}}e.define("joomla-field-mediamore",l)})(customElements,Joomla);
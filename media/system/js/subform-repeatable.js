!(function (y) { "use strict"; y.subformRepeatable = function (e, t) { if (this.$container = y(e), this.$container.data("subformRepeatable")) return r; this.$container.data("subformRepeatable", r), this.options = y.extend({}, y.subformRepeatable.defaults, t), this.template = "", this.prepareTemplate(), this.$containerRows = this.options.rowsContainer ? this.$container.find(this.options.rowsContainer) : this.$container; var r = this; this.$container.on("click", this.options.btAdd, (function (e) { e.preventDefault(); var t = y(this).parents(r.options.repeatableElement); t.length || (t = null), r.addRow(t) })), this.$container.on("click", this.options.btRemove, (function (e) { e.preventDefault(); var t = y(this).parents(r.options.repeatableElement); r.removeRow(t) })), this.options.btMove && this.$containerRows.sortable({ items: this.options.repeatableElement, handle: this.options.btMove, tolerance: "pointer" }), this.$container.trigger("subform-ready") }, y.subformRepeatable.prototype.prepareTemplate = function () { if (this.options.rowTemplateSelector) this.template = y.trim(this.$container.find(this.options.rowTemplateSelector).last().html()) || ""; else { var e = this.$container.find(this.options.repeatableElement).get(0), t = y(e).clone(); try { this.clearScripts(t) } catch (e) { window.console && console.log(e) } this.template = t.prop("outerHTML") } }, y.subformRepeatable.prototype.addRow = function (e) { var t = this.$containerRows.find(this.options.repeatableElement).length; if (t >= this.options.maximum) return null; var r = y.parseHTML(this.template); e ? y(e).after(r) : this.$containerRows.append(r); var o = y(r); o.attr("data-new", "true"), this.fixUniqueAttributes(o, t); try { this.fixScripts(o) } catch (e) { window.console && console.log(e) } return this.$container.trigger("subform-row-add", o), o }, y.subformRepeatable.prototype.removeRow = function (e) { this.$containerRows.find(this.options.repeatableElement).length <= this.options.minimum || (this.$container.trigger("subform-row-remove", e), e.remove()) }, y.subformRepeatable.prototype.fixUniqueAttributes = function (e, t, r, o) { var a = void 0 === r ? e.attr("data-group") : r, i = void 0 === o ? e.attr("data-base-name") : o, n = void 0 === t ? 0 : t, s = i + n; e.attr("data-group", s); for (var l = e.find("[name]"), p = {}, f = 0, c = l.length; f < c; f++) { var h = y(l[f]), u = h.attr("name"), b = u.replace(/(\[\]$)/g, "").replace(/(\]\[)/g, "__").replace(/\[/g, "_").replace(/\]/g, ""), d = u.replace("[" + a + "][", "[" + s + "]["), m = b.replace(a, s), v = 0, w = b; "checkbox" === h.prop("type") && u.match(/\[\]$/) ? ((v = p[b] ? p[b].length : 0) || (h.closest("fieldset.checkboxes").attr("id", m), e.find('label[for="' + b + '"]').attr("for", m).attr("id", m + "-lbl")), w += v, m += v) : "radio" === h.prop("type") && ((v = p[b] ? p[b].length : 0) || (h.closest("fieldset.radio").attr("id", m), e.find('label[for="' + b + '"]').attr("for", m).attr("id", m + "-lbl")), w += v, m += v), p[b] ? p[b].push(!0) : p[b] = [!0], h.attr("name", d), h.attr("id", m), e.find('label[for="' + w + '"]').attr("for", m).attr("id", m + "-lbl") } for (var R = e.find(this.options.rowTemplateSelector), g = 0; g < R.length; g++) { var $ = y(y(R[g]).prop("content")); this.fixUniqueAttributes($, n, a, i) } }, y.subformRepeatable.prototype.clearScripts = function (e) { y.fn.chosen && e.find("select.chzn-done").each((function () { var e = y(this); e.next(".chzn-container").remove(), e.show().addClass("fix-chosen") })) }, y.subformRepeatable.prototype.fixScripts = function (e) { e.find('a[onclick*="jInsertFieldValue"]').each((function () { var e = y(this), t = e.siblings('input[type="text"]').attr("id"), r = e.prev(), o = r.attr("href"); e.attr("onclick", "jInsertFieldValue('', '" + t + "');return false;"), r.attr("href", o.replace(/&fieldid=(.+)&/, "&fieldid=" + t + "&")) })), y.fn.fieldUser && e.find(".field-user-wrapper").fieldUser(), e.find("div.subform-repeatable").subformRepeatable() }, y.subformRepeatable.defaults = { btAdd: ".group-add", btRemove: ".group-remove", btMove: ".group-move", minimum: 0, maximum: 10, repeatableElement: ".subform-repeatable-group", rowTemplateSelector: "template.subform-repeatable-template-section", rowsContainer: null }, y.fn.subformRepeatable = function (e) { return this.each((function () { var e = e || {}, t = y(this).data(); if (!t.subformRepeatable) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]); var o = new y.subformRepeatable(this, e); y(this).data("subformRepeatable", o) } })) }, y(window).on("load", (function () { y("div.subform-repeatable").subformRepeatable() })) })(jQuery);


!function(){"use strict";Joomla=window.Joomla||{},Joomla.MediaManager=Joomla.MediaManager||{},function(){var e=Joomla.getOptions("com_media",{});if(!e)throw new Error('Initialization error "edit-images.js"');Joomla.MediaManager.Edit.original={filename:e.uploadPath.split("/").pop(),extension:e.uploadPath.split(".").pop(),contents:"data:image/"+e.uploadPath.split(".").pop()+";base64,"+e.contents},Joomla.MediaManager.Edit.history={},Joomla.MediaManager.Edit.current={};var a=function(e,a){if(a.contents){var t=document.getElementById("media-manager-edit-container"),o=document.createElement("div"),i=document.createElement("div"),n=document.createElement("img"),r=document.createElement("img");t.innerHTML="",n.src=a.contents,n.id="image-source",n.style.maxWidth="100%",r.src=a.contents,r.id="image-preview",r.style.maxWidth="100%",o.classList.add("hidden"),o.appendChild(n),t.appendChild(o),i.appendChild(r),t.appendChild(i),Joomla.MediaManager.Edit[e.toLowerCase()].Activate(a)}};Joomla.MediaManager.Edit.Reset=function(e){(!e||e&&"initial"===e)&&(Joomla.MediaManager.Edit.current.contents=Joomla.MediaManager.Edit.original.contents),document.getElementById("media-manager-edit-container").innerHTML="";var t=document.getElementById("myTab").firstElementChild;"UL"===t.tagName&&[].slice.call(t.querySelectorAll("a")).forEach((function(t){if(t.hasAttribute("active")){Joomla.MediaManager.Edit[t.id.replace("tab-attrib-","").toLowerCase()].Deactivate();var o=Joomla.MediaManager.Edit.current;(!e||e&&!0!==e)&&(o=Joomla.MediaManager.Edit.original),t.click();var i=document.getElementById("media-manager-edit-container");document.getElementById(t.id.replace("tab-","")).insertAdjacentElement("beforeend",i),a(t.id.replace("tab-attrib-",""),o)}}))},window.addEventListener("mediaManager.history.point",(function(){if(Joomla.MediaManager.Edit.original!==Joomla.MediaManager.Edit.current.contents){var e=Object.keys(Joomla.MediaManager.Edit.history).length;if(Joomla.MediaManager.Edit.history[e]&&Joomla.MediaManager.Edit.history[e-1]&&Joomla.MediaManager.Edit.history[e]===Joomla.MediaManager.Edit.history[e-1])return;Joomla.MediaManager.Edit.history[e+1]=Joomla.MediaManager.Edit.current.contents}})),Joomla.MediaManager.Edit.Undo=function(){},Joomla.MediaManager.Edit.Redo=function(){},Joomla.MediaManager.Edit.createProgressBar=function(){},Joomla.MediaManager.Edit.updateProgressBar=function(){},Joomla.MediaManager.Edit.removeProgressBar=function(){},Joomla.submitbutton=function(a){var t="jpg"===Joomla.MediaManager.Edit.original.extension?"jpeg":Joomla.MediaManager.Edit.original.extension,o=window.location.pathname.replace(/&view=file.*/g,""),i=e.uploadPath.split("/").pop(),n={name:i,content:Joomla.MediaManager.Edit.current.contents.replace("data:image/"+t+";base64,","")},r=e.uploadPath,d=e.apiBaseUrl+"&task=api.files&path="+r,l="application/json";n[e.csrfToken]="1";var m=r.split("/");switch(m.pop(),(m=m.join("/")).endsWith(":")&&(m+="/"),a){case"apply":Joomla.UploadFile.exec(i,JSON.stringify(n),r,d,l),Joomla.MediaManager.Edit.Reset(!0);break;case"save":Joomla.UploadFile.exec(i,JSON.stringify(n),r,d,l,(function(){this.readyState===XMLHttpRequest.DONE&&(window.self!==window.top?window.location=o+"?option=com_media&view=media&path="+m+"&tmpl=component":window.location=o+"?option=com_media&view=media&path="+m)}));break;case"cancel":window.self!==window.top?window.location=o+"?option=com_media&view=media&path="+m+"&tmpl=component":window.location=o+"?option=com_media&view=media&path="+m;break;case"reset":Joomla.MediaManager.Edit.Reset("initial")}},Joomla.UploadFile={},Joomla.UploadFile.exec=function(e,a,t,o,i,n){var r=new XMLHttpRequest;r.upload.onprogress=function(e){Joomla.MediaManager.Edit.updateProgressBar(e.loaded/e.total*100)},"function"==typeof n&&(r.onreadystatechange=n),r.onload=function(){var e;try{e=JSON.parse(r.responseText)}catch(a){e=null}e?200===r.status&&(!0===e.success&&Joomla.MediaManager.Edit.removeProgressBar(),"1"===e.status&&(Joomla.renderMessages({success:[e.message]},"true"),Joomla.MediaManager.Edit.removeProgressBar())):Joomla.MediaManager.Edit.removeProgressBar()},r.onerror=function(){Joomla.MediaManager.Edit.removeProgressBar()},r.open("PUT",o,!0),r.setRequestHeader("Content-Type",i),Joomla.MediaManager.Edit.createProgressBar(),r.send(a)},document.addEventListener("DOMContentLoaded",(function(){setTimeout((function e(){var t=document.getElementById("myTab").firstElementChild;if("UL"===t.tagName){var o=[].slice.call(t.querySelectorAll("a"));o[0]&&a(o[0].id.replace("tab-attrib-",""),Joomla.MediaManager.Edit.original),o.forEach((function(e){e.addEventListener("joomla.tab.shown",(function(e){var t=e.relatedTarget,o=e.target,i=document.getElementById("media-manager-edit-container");t&&(Joomla.MediaManager.Edit[t.id.replace("tab-attrib-","").toLowerCase()].Deactivate(),i.innerHTML="");var n=Joomla.MediaManager.Edit.current;"contents"in Joomla.MediaManager.Edit.current||(n=Joomla.MediaManager.Edit.original),document.getElementById(o.id.replace("tab-","")).insertAdjacentElement("beforeend",i),a(o.id.replace("tab-attrib-",""),n)})),e.click()})),o[0]&&(o[0].click(),a(o[0].id.replace("tab-attrib-",""),Joomla.MediaManager.Edit.original))}else setTimeout(e,50)}),50)}))}()}();
function jInsertFieldValue(e,i){var t=jQuery.noConflict(),o=t("#"+i).val();if(o!=e){var n=t("#"+i);n.val(e),n.trigger("change"),"function"==typeof n.get(0).onchange&&n.get(0).onchange(),jMediaRefreshPreview(i)}}function jMediaRefreshPreview(e){var i=jQuery.noConflict(),t=i("#"+e).val(),o=i("#"+e+"_preview"),n=i("#"+e).data("basepath");o.length&&(t?(o.attr("src",n+t),i("#"+e+"_preview_empty").hide(),i("#"+e+"_preview_img").show()):(o.attr("src",""),i("#"+e+"_preview_empty").show(),i("#"+e+"_preview_img").hide()))}function jMediaRefreshPreviewTip(e){var i=jQuery.noConflict(),t=i(e),o=t.find("img.media-preview");o.each(function(e,o){t.find("div.tip").css("max-width","none");var n=i(this).attr("id");n=n.substring(0,n.length-"_preview".length),jMediaRefreshPreview(n),t.show(this)})}function jMediaRefreshImgpathTip(e,i){var t=jQuery.noConflict(),o=t(e);o.css("max-width","none");var n=t(i).val();t("#TipImgpath").html(n),n.length?o.show():o.hide()}!function(e){"use strict";e.fieldMedia=function(i,t){this.options=e.extend({},e.fieldMedia.defaults,t),this.$container=e(i),this.$modal=this.$container.find(this.options.modal),this.$modalBody=this.$modal.children(".modal-body"),this.$input=this.$container.find(this.options.input),this.$containerPreview=this.$container.find(this.options.previewContainer),this.$buttonSelect=this.$container.find(this.options.buttonSelect),this.$buttonClear=this.$container.find(this.options.buttonClear),this.$buttonSelect.on("click",this.modalOpen.bind(this)),this.$buttonClear.on("click",this.clearValue.bind(this)),this.$modal.on("hide",this.removeIframe.bind(this)),this.updatePreview()},e.fieldMedia.prototype.modalOpen=function(){var i=e("<iframe>",{name:"field-media-modal",src:this.options.url.replace("{field-media-id}",this.$input.attr("id")),width:this.options.modalWidth,height:this.options.modalHeight});this.$modalBody.append(i),this.$modal.modal("show"),e("body").addClass("modal-open");var t=this;i.load(function(){var i=e(this).contents();i.on("click",t.options.buttonSaveSelected,function(){var e=i.find("#f_url").val();e&&t.setValue(e),t.modalClose.call(t)}),i.on("click",".button-cancel",function(){e("body").removeClass("modal-open"),t.modalClose.bind(t)})})},e.fieldMedia.prototype.modalClose=function(){this.$modal.modal("hide"),e("body").removeClass("modal-open"),this.$modalBody.empty()},e.fieldMedia.prototype.removeIframe=function(){this.$modalBody.empty(),e("body").removeClass("modal-open")},e.fieldMedia.prototype.setValue=function(e){this.$input.val(e).trigger("change"),this.updatePreview()},e.fieldMedia.prototype.clearValue=function(){this.setValue("")},e.fieldMedia.prototype.updatePreview=function(){if(this.options.preview)if(this.options.preview&&!this.options.previewAsTooltip){var i=this.$input.val();if(i){var t=new Image;t.src=this.options.basepath+i,t.width>t.height?this.$containerPreview.html(e("<img>",{src:t.src,style:"width: "+this.options.previewWidth+"px"})):this.$containerPreview.html(e("<img>",{src:t.src,style:"height: "+this.options.previewHeight+"px"}))}else this.$containerPreview.append("")}else{this.$containerPreview.popover("destroy"),this.$input.tooltip("destroy");var i=this.$input.val();if(i){var t=new Image(this.options.previewWidth,this.options.previewHeight);t.src=this.options.basepath+i,this.$containerPreview.popover({content:t}),this.$input.tooltip({placement:"top",title:i})}else this.$containerPreview.popover()}},e.fieldMedia.defaults={basepath:"",buttonClear:".button-clear",buttonSelect:".button-select",buttonSaveSelected:".button-save-selected",input:".field-media-input",preview:!0,previewAsTooltip:!0,previewContainer:".field-media-preview",previewWidth:200,previewHeight:200,url:"index.php?option=com_media&tmpl=component",modal:".modal",modalWidth:"100%",modalHeight:"300px"},e.fn.fieldMedia=function(i){return this.each(function(){var i=e(this),t=i.data("fieldMedia");if(!t){var o=o||{},n=i.data();for(var a in n)n.hasOwnProperty(a)&&(o[a]=n[a]);t=new e.fieldMedia(this,o),i.data("fieldMedia",t)}})},e(document).ready(function(){e(".field-media-wrapper").fieldMedia()})}(jQuery);